<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Teacher Activity Explorer</title>
<style>
  body { font-family: Arial, sans-serif; margin: 20px; background: #f2f2f2; }
  h1 { text-align: center; }
  .search-section, .tags-section, .buttons { margin-bottom: 20px; }
  .tags-section { display: flex; flex-wrap: wrap; gap: 5px; margin-bottom: 10px; }
  .tags-section h2 { width: 100%; margin-bottom: 5px; font-size: 1.1em; color: #333; }
  .tags-section button { margin: 3px; padding: 5px 10px; border: 1px solid #888; border-radius: 6px; background: #fff; cursor: pointer; transition: all 0.2s; }
  .tags-section button:hover { transform: scale(1.05); }
  .tags-section button.active { background-color: #4a90e2; color: white; }
  .buttons { text-align: center; }
  .buttons button { padding: 8px 16px; margin: 0 5px; border-radius: 6px; border: 1px solid #888; background-color: #eee; cursor: pointer; transition: all 0.2s; }
  .buttons button:hover { background-color: #ddd; }
  .activities { display: flex; flex-wrap: wrap; gap: 15px; justify-content: space-between; }
  .activity { border: 1px solid #ccc; padding: 10px; width: 30%; box-sizing: border-box; border-radius: 10px; box-shadow: 2px 2px 8px rgba(0,0,0,0.1); transition: transform 0.2s; }
  .activity:hover { transform: translateY(-2px); }
  .activity h3 { margin-top: 0; }
  .tags-caption { font-size: 0.85em; color: #888; margin-top: 6px; }
</style>
</head>
<body>

<h1>Teacher Activity Explorer</h1>

<!-- Search Bar -->
<div class="search-section">
  <input type="text" id="searchBox" placeholder="Search by activity name">
  <button onclick="searchActivities()">Search</button>
</div>

<!-- Tag Buttons -->
<div class="tags-section" id="tagButtons"></div>

<!-- Go Button -->
<div class="buttons">
  <button onclick="filterByTags()">Go</button>
</div>

<!-- Activity Windows -->
<div class="activities" id="activityContainer">
  <div class="activity"><h3>Activity 1</h3><p>Description...</p></div>
  <div class="activity"><h3>Activity 2</h3><p>Description...</p></div>
  <div class="activity"><h3>Activity 3</h3><p>Description...</p></div>
  <div class="activity"><h3>Activity 4</h3><p>Description...</p></div>
  <div class="activity"><h3>Activity 5</h3><p>Description...</p></div>
  <div class="activity"><h3>Activity 6</h3><p>Description...</p></div>
</div>

<script>
let activities = [];
let filteredActivities = [];
let currentTags = [];

// Tag groups
const tagGroups = {
  "Stage": ["PRE-ASSESSMENT","INTRODUCE","READ","ANALYZE","REVIEW","EVALUATE"],
  "Genre": ["LONG TEXT","SHORT TEXT","POETRY","VISUAL ART","VOCABULARY","GRAMMAR","PUNCTUATION","SPEECH","ARTICLE / ESSAY","VISUAL ART / MEDIA"],
  "Mode": ["WRITING (short)","WRITING (long)","WRITING (creative)","DISCUSSION","VISUAL ART"],
  "Misc": ["GAMES","ICEBREAKERS","FORMING GROUPS","ON YOUR FEET"]
};

// Layer colors
const layerColors = {
  "PRE-ASSESSMENT": "#d6eaf8",
  "INTRODUCE": "#fdebd0",
  "READ": "#d5f5e3",
  "ANALYZE": "#f9e79f",
  "REVIEW": "#f5cba7",
  "EVALUATE": "#d2b4de",
  "GAMES": "#d6eaf9",
  "ON YOUR FEET": "#fdebd1",
  "VISUAL ART": "#d5f5e4",
  "FORMING GROUPS": "#f9e79f",
  "WRITING (short)": "#f5cba8",
  "WRITING (long)": "#f0d9ff",
  "WRITING (creative)": "#d2b4de",
  "DISCUSSION": "#f5e6c8",
  "SPEECH": "#d0f0c0",
  "ARTICLE / ESSAY": "#f0d0c0",
  "LONG TEXT": "#d0e0f0",
  "SHORT TEXT": "#f0f0d0",
  "POETRY": "#e0d0f0",
  "VOCABULARY": "#d0f0e0",
  "GRAMMAR": "#f0e0f0",
  "PUNCTUATION": "#e0f0d0",
  "VISUAL ART / MEDIA": "#f0d0f0"
};

// Create tag buttons
const tagContainer = document.getElementById("tagButtons");
for(const group in tagGroups){
  const heading = document.createElement("h2");
  heading.innerText = group;
  tagContainer.appendChild(heading);
  tagGroups[group].forEach(tag => {
    const btn = document.createElement("button");
    btn.innerText = tag;
    btn.onclick = () => {
      btn.classList.toggle("active");
      currentTags = Array.from(document.querySelectorAll(".tags-section button.active")).map(b => b.innerText);
    };
    tagContainer.appendChild(btn);
  });
}

// Load activities JSON
fetch('activities.json')
  .then(res => res.json())
  .then(data => {
    activities = data;
    filteredActivities = [...activities];
    pickRandomActivities();
  })
  .catch(err => console.error("Error loading activities:", err));

// Pick 6 random activities
function pickRandomActivities() {
  const copy = [...filteredActivities];
  const result = [];
  while(result.length < 6 && copy.length > 0){
    const index = Math.floor(Math.random() * copy.length);
    result.push(copy.splice(index,1)[0]);
  }
  renderActivities(result);
}

// Render activities
function renderActivities(list) {
  const container = document.getElementById("activityContainer");
  const windows = container.querySelectorAll(".activity");
  windows.forEach((win, i) => {
    if(list[i]) {
      win.querySelector("h3").innerText = list[i]["Activity Name"];
      win.querySelector("p").innerText = list[i]["Description"];
      const allTags = [list[i]["Stage (Layer 1)"], list[i]["Genre/Production (Layer 2/3)"], list[i]["Miscellaneous Tags"]].filter(Boolean).join(", ");
      let caption = win.querySelector(".tags-caption");
      if(!caption){
        caption = document.createElement("div");
        caption.className = "tags-caption";
        win.appendChild(caption);
      }
      caption.innerText = allTags;

      // Pick first tag with color
      const allTagsForColor = [list[i]["Stage (Layer 1)"], list[i]["Genre/Production (Layer 2/3)"], list[i]["Miscellaneous Tags"]];
      let color = "#fff";
      for(let t of allTagsForColor){
        if(t && layerColors[t]) { color = layerColors[t]; break; }
      }
      win.style.backgroundColor = color;
    } else {
      win.querySelector("h3").innerText = "No Activity";
      win.querySelector("p").innerText = "";
      let caption = win.querySelector(".tags-caption");
      if(caption) caption.innerText = "";
      win.style.backgroundColor = "#fff";
    }
  });
}

// Search by name
function searchActivities() {
  const query = document.getElementById("searchBox").value.toLowerCase();
  filteredActivities = activities.filter(a => a["Activity Name"].toLowerCase().includes(query));
  pickRandomActivities();
}

// Filter by selected tags (AND logic)
function filterByTags() {
  if(currentTags.length === 0) {
    filteredActivities = [...activities];
  } else {
    filteredActivities = activities.filter(a => {
      const allActivityTags = [
        a["Stage (Layer 1)"],
        a["Genre/Production (Layer 2/3)"],
        a["Miscellaneous Tags"]
      ].join(" / ").toLowerCase();
      return currentTags.every(tag => allActivityTags.includes(tag.toLowerCase()));
    });
  }
  pickRandomActivities();
}
</script>

</body>
</html>
